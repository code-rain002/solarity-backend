<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Solarity Test</title>
  </head>
  <body>
    <button id="register">Register</button>
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script>
      (($) => {
        $(document).ready(function ($) {
          $("#register").click(async function (e) {
            e.preventDefault();
            try {
              const data = await $.post("/api/auth/register/wallet", {
                requestNonce: true,
                publicAddress: "FWK5fYJ3znNoe4rJ3fcRJtDBdXqeEZz7mjZwseVV7MAs",
              });
              const { nonce } = data;
              // signed@
              const { solana } = window.phantom;
              await solana.connect();
              const encoded = new TextEncoder().encode(nonce);
              const { signature } = await solana.request({
                method: "signMessage",
                params: {
                  message: encoded,
                },
              });
              const response = await $.post("/api/auth/register/wallet", {
                requestNonce: false,
                signature,
                publicAddress: "FWK5fYJ3znNoe4rJ3fcRJtDBdXqeEZz7mjZwseVV7MAs",
              });
              console.log(response);
            } catch (err) {
              console.log(err);
            }
            console.log("register");
            // let dataArray = $("#loginForm").serializeArray();
            // const data = {};
            // dataArray.forEach(({ name, value }) => (data[name] = value));
            // $.post("/api/auth/login", data, () => {
            //   console.log("logged in");
            // });
          });
        });
      })(jQuery);
    </script>
  </body>
</html>
